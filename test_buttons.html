<!DOCTYPE html>
<html>
<head>
    <title>Button Test Page</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .btn { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn-success { background: #28a745 !important; }
        .btn-danger { background: #dc3545 !important; }
        #status { display: none; margin: 20px 0; }
        #console-log { background: #f8f9fa; border: 1px solid #ddd; padding: 10px; margin: 20px 0; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ðŸ”§ Button Test Page</h1>
    
    <div id="status"></div>
    
    <div id="console-log"></div>
    
    <div style="background: #f0f0f0; padding: 20px; margin: 20px 0;">
        <h3>Backend Error: <span id="error-status">TypeError: Load failed</span></h3>
        
        <button class="btn" onclick="testBackendStart()">Test Backend Start</button>
        <button class="btn" onclick="testTEPStart()">Test TEP Start</button>
        <button class="btn" onclick="testStatus()">Test Status</button>
    </div>

    <script>
        // Override console.log to show in page
        const originalLog = console.log;
        const originalError = console.error;
        const logDiv = document.getElementById('console-log');
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };

        console.log('Test page loaded');

        function showMessage(message, type = 'info') {
            console.log('showMessage:', message, type);
            const statusDiv = document.getElementById('status');
            if (!statusDiv) {
                console.error('Status div not found!');
                alert(message);
                return;
            }
            statusDiv.textContent = message;
            statusDiv.className = type === 'success' ? 'btn-success' :
                                 type === 'error' ? 'btn-danger' : 'btn-primary';
            statusDiv.style.display = 'block';
            statusDiv.style.padding = '15px';
            statusDiv.style.borderRadius = '8px';
            statusDiv.style.marginBottom = '20px';
            statusDiv.style.fontWeight = 'bold';

            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function testBackendStart() {
            console.log('testBackendStart() called');
            const btn = event.target;
            btn.disabled = true;
            
            fetch('http://127.0.0.1:9001/api/faultexplainer/backend/start', {method: 'POST'})
                .then(response => {
                    console.log('Backend response:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Backend data:', data);
                    showMessage(data.message, data.success ? 'success' : 'error');
                    document.getElementById('error-status').textContent = data.success ? 'Success!' : 'Failed';
                })
                .catch(e => {
                    console.error('Backend error:', e);
                    showMessage(`Backend start failed: ${e}`, 'error');
                    document.getElementById('error-status').textContent = `Error: ${e}`;
                })
                .finally(() => btn.disabled = false);
        }

        function testTEPStart() {
            console.log('testTEPStart() called');
            const btn = event.target;
            btn.disabled = true;
            
            fetch('http://127.0.0.1:9001/api/tep/start', {method: 'POST'})
                .then(response => {
                    console.log('TEP response:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('TEP data:', data);
                    showMessage(data.message, data.success ? 'success' : 'error');
                })
                .catch(e => {
                    console.error('TEP error:', e);
                    showMessage(`TEP start failed: ${e}`, 'error');
                })
                .finally(() => btn.disabled = false);
        }

        function testStatus() {
            console.log('testStatus() called');
            
            fetch('http://127.0.0.1:9001/api/status')
                .then(response => response.json())
                .then(data => {
                    console.log('Status data:', data);
                    showMessage(`Status: TEP=${data.tep_running}, Backend=${data.backend_running}`, 'success');
                })
                .catch(e => {
                    console.error('Status error:', e);
                    showMessage(`Status failed: ${e}`, 'error');
                });
        }

        // Test status on load
        setTimeout(testStatus, 1000);
    </script>
</body>
</html>
